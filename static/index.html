<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Учет продукции на складе</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <div id="error" class="text-red-500 p-4"></div>
  <script>
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
      document.getElementById('error').innerText = 'Ошибка: React не загружен';
      throw new Error('React не загружен');
    }
    console.log('React загружен успешно');

    const { useState, useEffect } = React;

    const App = () => {
      const [user, setUser] = useState(null);
      const [companies, setCompanies] = useState([]);
      const [error, setError] = useState('');

      useEffect(() => {
        console.log('Попытка загрузки компаний...');
        fetch('/api/companies', { mode: 'cors' })
          .then(response => {
            console.log('Ответ от /api/companies:', response.status);
            if (!response.ok) throw new Error('Ошибка: ' + response.status);
            return response.json();
          })
          .then(data => {
            console.log('Компании:', data);
            setCompanies(data || []);
          })
          .catch(err => {
            console.error('Ошибка:', err);
            setError(err.message);
          });
      }, []);

      const handleLogin = (e) => {
        e.preventDefault();
        setUser('Леонид'); // Простая авторизация для теста
      };

      return (
        <div className="container mx-auto p-4">
          {!user ? (
            <div className="max-w-md mx-auto">
              <h1 className="text-2xl font-bold mb-4">Вход</h1>
              <form onSubmit={handleLogin} className="space-y-4">
                <button type="submit" className="w-full bg-blue-500 text-white p-2 rounded">Войти как Леонид</button>
              </form>
              {error && <p className="mt-2 text-red-500">{error}</p>}
            </div>
          ) : (
            <div>
              <h1 className="text-2xl font-bold mb-4">Учет продукции - {user}</h1>
              <p>Компании: {companies.join(', ') || 'Загрузка...'}</p>
              {error && <p className="mt-2 text-red-500">{error}</p>}
            </div>
          )}
        </div>
      );
    };

    try {
      ReactDOM.render(<App />, document.getElementById('root'));
      console.log('ReactDOM.render выполнен успешно');
    } catch (e) {
      document.getElementById('error').innerText = 'Ошибка рендеринга: ' + e.message;
      console.error('Ошибка рендеринга:', e);
    }
  </script>
</body>
</html>