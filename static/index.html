<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Учет продукции на складе</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <div id="error" class="text-red-500 p-4"></div>
  <script>
    const { useState, useEffect } = React;

    const App = () => {
      const [user, setUser] = useState(null);
      const [userRole, setUserRole] = useState(null);
      const [userName, setUserName] = useState('');
      const [password, setPassword] = useState('');
      const [inventory, setInventory] = useState([]);
      const [shipments, setShipments] = useState([]);
      const [newShipment, setNewShipment] = useState({
        date: new Date().toISOString().split('T')[0],
        product: '',
        lot: '',
        client: '',
        quantity: '',
        manager: '',
        company: 'БТТ'
      });
      const [newStock, setNewStock] = useState({
        date: new Date().toISOString().split('T')[0],
        product: '',
        lot: '',
        quantity: '',
        expiryDate: '',
        company: 'БТТ'
      });
      const [activeTab, setActiveTab] = useState('inventory');
      const [products, setProducts] = useState([]);
      const [clients, setClients] = useState([]);
      const [managers, setManagers] = useState([]);
      const [error, setError] = useState('');
      const [filterProduct, setFilterProduct] = useState('Все продукты');
      const [filterClient, setFilterClient] = useState('Все клиенты');
      const [filterManager, setFilterManager] = useState('Все менеджеры');
      const [editItem, setEditItem] = useState(null);
      const [company, setCompany] = useState('БТТ');
      const [companies, setCompanies] = useState([]);
      const [startDate, setStartDate] = useState('');
      const [endDate, setEndDate] = useState('');

      const admins = [
        { username: 'Леонид', password: '12345678lm' },
        { username: 'Ольга', password: '12345678oc' },
        { username: 'Дмитрий', password: '12345678dd' }
      ];

      useEffect(() => {
        fetch('/api/companies')
          .then(response => response.json())
          .then(data => {
            console.log('Компании:', data);
            setCompanies(data || ['БТТ', 'ЛИ']);
          })
          .catch(error => setError('Ошибка загрузки компаний: ' + error.message));
      }, []);

      useEffect(() => {
        const loadData = (username, company) => {
          fetch(`/api/data/${username}/${company}`)
            .then(response => {
              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              return response.json();
            })
            .then(data => {
              console.log('Данные загружены для компании:', company, data);
              // Добавляем поле company, если его нет, и фильтруем
              const filteredInventory = (data.inventory || []).map((item, index) => ({
                ...item,
                company: item.company || company,
                id: item.id || `inv_${Date.now()}_${index}`
              })).filter(item => item.company === company);
              const filteredShipments = (data.shipments || []).map((item, index) => ({
                ...item,
                company: item.company || company,
                id: item.id || `ship_${Date.now()}_${index}`
              })).filter(item => item.company === company);
              setInventory(filteredInventory);
              setShipments(filteredShipments);
              const allProducts = [...new Set([...filteredInventory.map(i => i.product), ...filteredShipments.map(s => s.product)])];
              const allClients = [...new Set(filteredShipments.map(s => s.client))];
              const allManagers = [...new Set(filteredShipments.map(s => s.manager))];
              setProducts(allProducts.filter(p => p));
              setClients(allClients.filter(c => c));
              setManagers(allManagers.filter(m => m));
            })
            .catch(error => setError('Ошибка загрузки данных: ' + error.message));
        };

        if (user) {
          loadData(user, company);
          console.log('Пользователь авторизован:', user, 'Компания:', company);
        } else {
          loadData('Леонид', company);
          console.log('Гостевой доступ для:', 'Леонид', 'Компания:', company);
        }
      }, [user, company]);

      useEffect(() => {
        if (user && userRole === 'admin') {
          saveData(user, company, { inventory, shipments });
        }
      }, [inventory, shipments, user]);

      const saveData = (username, company, data) => {
        fetch(`/api/data/${username}/${company}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        })
        .then(response => {
          if (!response.ok) throw new Error('Ошибка сохранения данных');
          return response.json();
        })
        .catch(error => setError('Ошибка сохранения данных: ' + error.message));
      };

      const handleLogin = (e) => {
        e.preventDefault();
        if (!userName.trim()) {
          setError('Введите имя пользователя');
          return;
        }
        const trimmedUserName = userName.trim();
        console.log('Попытка логина:', { username: trimmedUserName, password });
        const isAdmin = admins.find(
          admin => admin.username.toLowerCase() === trimmedUserName.toLowerCase() && admin.password === password
        );
        if (password && !isAdmin) {
          setError('Неверный пароль для администратора');
          return;
        }
        setUser(trimmedUserName);
        setUserRole(isAdmin ? 'admin' : 'viewer');
        setPassword('');
        console.log('Логин успешен:', { user: trimmedUserName, role: userRole });
      };

      const handleStockSubmit = (e) => {
        e.preventDefault();
        if (userRole !== 'admin') {
          setError('Только администраторы могут добавлять остатки');
          return;
        }
        try {
          if (editItem) {
            setInventory(inventory.map(item => item.id === editItem.id ? { ...newStock, quantity: Number(newStock.quantity), company, id: editItem.id } : item));
          } else {
            const existing = inventory.find(item => item.product === newStock.product && item.lot === newStock.lot && item.company === company);
            if (existing) {
              setInventory(inventory.map(item => item.product === newStock.product && item.lot === newStock.lot && item.company === company
                ? { ...item, quantity: Number(item.quantity) + Number(newStock.quantity), expiryDate: newStock.expiryDate }
                : item));
            } else {
              setInventory([...inventory, { ...newStock, quantity: Number(newStock.quantity), company, id: `inv_${Date.now()}_${inventory.length}` }]);
            }
          }
          if (!products.includes(newStock.product) && newStock.product) setProducts([...products, newStock.product]);
          setNewStock({ date: newStock.date, product: '', lot: '', quantity: '', expiryDate: '', company });
          setEditItem(null);
          setError('');
        } catch (e) {
          setError('Ошибка при добавлении/обновлении остатка: ' + e.message);
        }
      };

      const handleShipmentSubmit = (e) => {
        e.preventDefault();
        if (userRole !== 'admin') {
          setError('Только администраторы могут добавлять отгрузки');
          return;
        }
        try {
          if (editItem) {
            setShipments(shipments.map(item => item.id === editItem.id ? { ...newShipment, company, id: editItem.id } : item));
            const stock = inventory.find(item => item.product === newShipment.product && item.lot === newShipment.lot && item.company === company);
            if (stock && Number(newShipment.quantity) > (stock.quantity + (editItem.quantity || 0))) {
              setError('Недостаточно продукции на складе!');
              return;
            }
            setInventory(inventory.map(item => item.product === newShipment.product && item.lot === newShipment.lot && item.company === company
              ? { ...item, quantity: Number(item.quantity) + Number(editItem.quantity) - Number(newShipment.quantity) }
              : item));
          } else {
            const stock = inventory.find(item => item.product === newShipment.product && item.lot === newShipment.lot && item.company === company);
            if (!stock || stock.quantity < Number(newShipment.quantity)) {
              setError('Недостаточно продукции на складе!');
              return;
            }
            setShipments([...shipments, { ...newShipment, company, id: `ship_${Date.now()}_${shipments.length}` }]);
            setInventory(inventory.map(item => item.product === newShipment.product && item.lot === newShipment.lot && item.company === company
              ? { ...item, quantity: Number(item.quantity) - Number(newShipment.quantity) }
              : item));
          }
          if (!products.includes(newShipment.product) && newShipment.product) setProducts([...products, newShipment.product]);
          if (!clients.includes(newShipment.client) && newShipment.client) setClients([...clients, newShipment.client]);
          if (!managers.includes(newShipment.manager) && newShipment.manager) setManagers([...managers, newShipment.manager]);
          setNewShipment({ date: newShipment.date, product: newShipment.product, lot: '', client: newShipment.client, quantity: '', manager: newShipment.manager, company });
          setEditItem(null);
          setError('');
        } catch (e) {
          setError('Ошибка при добавлении/обновлении отгрузки: ' + e.message);
        }
      };

      const exportToExcel = (data, filename, headers) => {
        try {
          if (!data || data.length === 0) {
            setError('Нет данных для экспорта');
            return;
          }
          const ws = XLSX.utils.json_to_sheet(data, { header: headers });
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
          const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
          saveAs(new Blob([wbout], { type: 'application/octet-stream' }), filename);
        } catch (e) {
          setError('Ошибка экспорта в Excel: ' + e.message);
        }
      };

      const exportToWord = (data, filename) => {
        try {
          if (!data || data.length === 0) {
            setError('Нет данных для экспорта');
            return;
          }
          let docContent = '<html><body><h1>' + filename.replace('.docx', '') + '</h1><table border="1">';
          docContent += '<tr><th>Дата</th><th>Клиент</th><th>Продукция</th><th>№ Лота</th><th>Количество</th><th>Менеджер</th></tr>';
          data.forEach(item => {
            docContent += '<tr><td>' + item.Дата + '</td><td>' + (item.Клиент || '') + '</td><td>' + item.Продукция + '</td><td>' + item['№ Лота'] + '</td><td>' + item.Количество + '</td><td>' + (item.Менеджер || '') + '</td></tr>';
          });
          docContent += '</table></body></html>';
          saveAs(new Blob(['\ufeff', docContent], { type: 'application/msword' }), filename);
        } catch (e) {
          setError('Ошибка экспорта в Word: ' + e.message);
        }
      };

      const handleExportInventory = () => {
        const filteredInventory = inventory.filter(item => item.company === company && (filterProduct === 'Все продукты' || item.product === filterProduct));
        const data = filteredInventory.map(item => ({
          Дата: item.date,
          Продукция: item.product,
          '№ Лота': item.lot,
          Количество: item.quantity,
          'Срок годности': item.expiryDate
        }));
        exportToExcel(data, `inventory_${user || 'guest'}_${company}.xlsx`, ['Дата', 'Продукция', '№ Лота', 'Количество', 'Срок годности']);
        exportToWord(data, `inventory_${user || 'guest'}_${company}.docx`);
      };

      const handleExportShipments = () => {
        const filteredShipments = shipments
          .filter(item => item.company === company)
          .filter(item => filterProduct === 'Все продукты' || item.product === filterProduct)
          .filter(item => filterClient === 'Все клиенты' || item.client === filterClient)
          .filter(item => filterManager === 'Все менеджеры' || item.manager === filterManager)
          .filter(item => {
            if (!startDate && !endDate) return true;
            const itemDate = new Date(item.date);
            const start = startDate ? new Date(startDate) : new Date(0);
            const end = endDate ? new Date(endDate) : new Date();
            end.setHours(23, 59, 59, 999);
            return itemDate >= start && itemDate <= end;
          });
        const data = filteredShipments.map(item => ({
          Дата: item.date,
          Клиент: item.client,
          Продукция: item.product,
          '№ Лота': item.lot,
          Количество: item.quantity,
          Менеджер: item.manager
        }));
        exportToExcel(data, `shipments_${user || 'guest'}_${company}.xlsx`, ['Дата', 'Клиент', 'Продукция', '№ Лота', 'Количество', 'Менеджер']);
        exportToWord(data, `shipments_${user || 'guest'}_${company}.docx`);
      };

      const availableLots = newShipment.product
        ? inventory.filter(item => item.product === newShipment.product && item.quantity > 0 && item.company === company).map(item => item.lot).filter((lot, index, self) => self.indexOf(lot) === index)
        : [];

      const handleEdit = (item) => {
        if (userRole !== 'admin') {
          setError('Только администраторы могут редактировать записи');
          return;
        }
        setEditItem(item);
        if (item.hasOwnProperty('client')) setNewShipment({ ...item });
        else setNewStock({ ...item });
      };

      const handleDelete = (item, isInventory) => {
        if (userRole !== 'admin') {
          setError('Только администраторы могут удалять записи');
          return;
        }
        if (window.confirm(`Удалить запись ${item.product}, № Лота ${item.lot}?`)) {
          try {
            if (isInventory) setInventory(inventory.filter(i => i.id !== item.id));
            else {
              const stock = inventory.find(i => i.product === item.product && i.lot === item.lot && i.company === company);
              if (stock) setInventory(inventory.map(i => i.product === item.product && i.lot === item.lot && i.company === company
                ? { ...i, quantity: Number(i.quantity) + Number(item.quantity) }
                : i));
              setShipments(shipments.filter(s => s.id !== item.id));
            }
            setError('');
          } catch (e) {
            setError('Ошибка при удалении записи: ' + e.message);
          }
        }
      };

      const groupInventoryByProduct = () => {
        const filteredInventory = inventory.filter(item => item.company === company && (filterProduct === 'Все продукты' || item.product === filterProduct));
        const grouped = {};
        filteredInventory.forEach(item => {
          if (!grouped[item.product]) grouped[item.product] = [];
          grouped[item.product].push(item);
        });
        return grouped;
      };

      if (!user) {
        return React.createElement(
          'div',
          { className: 'container mx-auto p-4' },
          React.createElement('h1', { className: 'text-2xl font-bold mb-4' }, 'Вход в систему'),
          React.createElement(
            'form',
            { onSubmit: handleLogin, className: 'flex space-x-2' },
            React.createElement('input', {
              type: 'text',
              placeholder: 'Имя пользователя',
              value: userName,
              onChange: (e) => setUserName(e.target.value),
              className: 'border p-2 rounded'
            }),
            React.createElement('input', {
              type: 'password',
              placeholder: 'Пароль (для админов)',
              value: password,
              onChange: (e) => setPassword(e.target.value),
              className: 'border p-2 rounded'
            }),
            React.createElement(
              'button',
              { type: 'submit', className: 'bg-blue-500 text-white p-2 rounded' },
              'Войти'
            )
          ),
          error && React.createElement('div', { className: 'text-red-500 mt-2' }, error)
        );
      }

      return React.createElement(
        'div',
        { className: 'container mx-auto p-4' },
        React.createElement(
          'div',
          { className: 'flex justify-between items-center mb-4' },
          React.createElement(
            'h1',
            { className: 'text-2xl font-bold' },
            `Учет продукции (Пользователь: ${user}, Роль: ${userRole === 'admin' ? 'Админ' : 'Просмотр'}, Компания: ${company})`
          ),
          React.createElement(
            'button',
            {
              onClick: () => { setUser(null); setUserRole(null); setError(''); },
              className: 'bg-red-500 text-white p-2 rounded'
            },
            'Выйти'
          )
        ),
        React.createElement(
          'div',
          { className: 'mb-4' },
          React.createElement(
            'button',
            {
              className: `p-2 ${activeTab === 'inventory' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`,
              onClick: () => setActiveTab('inventory')
            },
            'Остатки'
          ),
          React.createElement(
            'button',
            {
              className: `p-2 ${activeTab === 'shipments' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`,
              onClick: () => setActiveTab('shipments')
            },
            'Отгрузки'
          ),
          React.createElement(
            'select',
            {
              value: filterProduct,
              onChange: (e) => setFilterProduct(e.target.value),
              className: 'border p-2 rounded ml-4'
            },
            React.createElement('option', { value: 'Все продукты' }, 'Все продукты'),
            products.map((product, index) => React.createElement('option', { key: index, value: product }, product))
          ),
          React.createElement(
            'select',
            {
              value: company,
              onChange: (e) => {
                setCompany(e.target.value);
                console.log('Смена компании на:', e.target.value);
              },
              className: 'border p-2 rounded ml-2'
            },
            companies.map((c, index) => React.createElement('option', { key: index, value: c }, c))
          )
        ),
        error && React.createElement('div', { className: 'text-red-500 mb-4' }, error),
        activeTab === 'inventory' && React.createElement(
          'div',
          null,
          React.createElement(
            'div',
            { className: 'mb-8' },
            React.createElement('h2', { className: 'text-xl font-semibold mb-2' }, 'Добавить остаток'),
            userRole !== 'admin' ? React.createElement('p', { className: 'text-red-500' }, 'Только админы') : React.createElement(
              'div',
              { className: 'flex space-x-2' },
              React.createElement('input', {
                type: 'date',
                value: newStock.date,
                onChange: (e) => setNewStock({ ...newStock, date: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Продукция',
                value: newStock.product,
                list: 'productsList',
                onChange: (e) => setNewStock({ ...newStock, product: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('datalist', { id: 'productsList' }, products.map((product, index) => React.createElement('option', { key: index, value: product }))),
              React.createElement('input', {
                type: 'text',
                placeholder: '№ Лота',
                value: newStock.lot,
                onChange: (e) => setNewStock({ ...newStock, lot: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('input', {
                type: 'number',
                placeholder: 'Количество',
                value: newStock.quantity,
                onChange: (e) => setNewStock({ ...newStock, quantity: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('input', {
                type: 'date',
                placeholder: 'Срок годности',
                value: newStock.expiryDate,
                onChange: (e) => setNewStock({ ...newStock, expiryDate: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement(
                'button',
                { onClick: handleStockSubmit, className: 'bg-blue-500 text-white p-2 rounded' },
                editItem ? 'Сохранить' : 'Добавить'
              )
            )
          ),
          React.createElement(
            'button',
            { onClick: handleExportInventory, className: 'bg-purple-500 text-white p-2 rounded mb-4' },
            'Экспорт остатков'
          ),
          Object.keys(groupInventoryByProduct()).map(product => React.createElement(
            'div',
            { key: product, className: 'mb-4' },
            React.createElement('h3', { className: 'text-lg font-semibold' }, product || 'Без названия'),
            React.createElement(
              'table',
              { className: 'w-full border-collapse border' },
              React.createElement(
                'thead',
                null,
                React.createElement(
                  'tr',
                  { className: 'bg-gray-200' },
                  React.createElement('th', { className: 'border p-2' }, 'Дата'),
                  React.createElement('th', { className: 'border p-2' }, '№ Лота'),
                  React.createElement('th', { className: 'border p-2' }, 'Количество'),
                  React.createElement('th', { className: 'border p-2' }, 'Срок годности'),
                  React.createElement('th', { className: 'border p-2' }, 'Действия')
                )
              ),
              React.createElement(
                'tbody',
                null,
                groupInventoryByProduct()[product].map((item, index) => React.createElement(
                  'tr',
                  { key: index },
                  React.createElement('td', { className: 'border p-2' }, item.date),
                  React.createElement('td', { className: 'border p-2' }, item.lot),
                  React.createElement('td', { className: 'border p-2' }, item.quantity),
                  React.createElement('td', { className: 'border p-2' }, item.expiryDate),
                  React.createElement(
                    'td',
                    { className: 'border p-2' },
                    React.createElement(
                      'button',
                      { onClick: () => handleEdit(item), className: 'bg-yellow-500 text-white p-1 rounded mr-2' },
                      'Ред.'
                    ),
                    React.createElement(
                      'button',
                      { onClick: () => handleDelete(item, true), className: 'bg-red-500 text-white p-1 rounded' },
                      'Удал.'
                    )
                  )
                ))
              )
            )
          ))
        ),
        activeTab === 'shipments' && React.createElement(
          'div',
          null,
          React.createElement(
            'div',
            { className: 'mb-8' },
            React.createElement('h2', { className: 'text-xl font-semibold mb-2' }, 'Добавить отгрузку'),
            userRole !== 'admin' ? React.createElement('p', { className: 'text-red-500' }, 'Только админы') : React.createElement(
              'div',
              { className: 'flex space-x-2' },
              React.createElement('input', {
                type: 'date',
                value: newShipment.date,
                onChange: (e) => setNewShipment({ ...newShipment, date: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Клиент',
                value: newShipment.client,
                list: 'clientsList',
                onChange: (e) => setNewShipment({ ...newShipment, client: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('datalist', { id: 'clientsList' }, clients.map((client, index) => React.createElement('option', { key: index, value: client }))),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Продукция',
                value: newShipment.product,
                list: 'productsList',
                onChange: (e) => setNewShipment({ ...newShipment, product: e.target.value, lot: '' }),
                className: 'border p-2 rounded'
              }),
              React.createElement('datalist', { id: 'productsList' }, products.map((product, index) => React.createElement('option', { key: index, value: product }))),
              React.createElement('input', {
                type: 'text',
                placeholder: '№ Лота',
                value: newShipment.lot,
                list: 'lotsList',
                onChange: (e) => setNewShipment({ ...newShipment, lot: e.target.value }),
                className: 'border p-2 rounded',
                disabled: !newShipment.product
              }),
              React.createElement('datalist', { id: 'lotsList' }, availableLots.map((lot, index) => React.createElement('option', { key: index, value: lot }))),
              React.createElement('input', {
                type: 'number',
                placeholder: 'Количество',
                value: newShipment.quantity,
                onChange: (e) => setNewShipment({ ...newShipment, quantity: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Менеджер',
                value: newShipment.manager,
                list: 'managersList',
                onChange: (e) => setNewShipment({ ...newShipment, manager: e.target.value }),
                className: 'border p-2 rounded'
              }),
              React.createElement('datalist', { id: 'managersList' }, managers.map((manager, index) => React.createElement('option', { key: index, value: manager }))),
              React.createElement(
                'button',
                { onClick: handleShipmentSubmit, className: 'bg-green-500 text-white p-2 rounded' },
                editItem ? 'Сохранить' : 'Отгрузить'
              )
            )
          ),
          React.createElement(
            'button',
            { onClick: handleExportShipments, className: 'bg-purple-500 text-white p-2 rounded mb-4' },
            'Экспорт отгрузок'
          ),
          React.createElement(
            'div',
            { className: 'mb-4 flex space-x-4' },
            React.createElement('label', { className: 'mr-2' }, 'Фильтр по продукции:'),
            React.createElement(
              'select',
              {
                value: filterProduct,
                onChange: (e) => setFilterProduct(e.target.value),
                className: 'border p-2 rounded'
              },
              React.createElement('option', { value: 'Все продукты' }, 'Все продукты'),
              products.map((product, index) => React.createElement('option', { key: index, value: product }, product))
            ),
            React.createElement('label', { className: 'mr-2' }, 'Фильтр по клиенту:'),
            React.createElement(
              'select',
              {
                value: filterClient,
                onChange: (e) => setFilterClient(e.target.value),
                className: 'border p-2 rounded'
              },
              React.createElement('option', { value: 'Все клиенты' }, 'Все клиенты'),
              clients.map((client, index) => React.createElement('option', { key: index, value: client }, client))
            ),
            React.createElement('label', { className: 'mr-2' }, 'Фильтр по менеджеру:'),
            React.createElement(
              'select',
              {
                value: filterManager,
                onChange: (e) => setFilterManager(e.target.value),
                className: 'border p-2 rounded'
              },
              React.createElement('option', { value: 'Все менеджеры' }, 'Все менеджеры'),
              managers.map((manager, index) => React.createElement('option', { key: index, value: manager }, manager))
            ),
            React.createElement('label', { className: 'mr-2' }, 'С:'),
            React.createElement('input', {
              type: 'date',
              value: startDate,
              onChange: (e) => setStartDate(e.target.value),
              className: 'border p-2 rounded'
            }),
            React.createElement('label', { className: 'mr-2 ml-2' }, 'По:'),
            React.createElement('input', {
              type: 'date',
              value: endDate,
              onChange: (e) => setEndDate(e.target.value),
              className: 'border p-2 rounded'
            })
          ),
          React.createElement(
            'table',
            { className: 'w-full border-collapse border' },
            React.createElement(
              'thead',
              null,
              React.createElement(
                'tr',
                { className: 'bg-gray-200' },
                React.createElement('th', { className: 'border p-2' }, 'Дата'),
                React.createElement('th', { className: 'border p-2' }, 'Клиент'),
                React.createElement('th', { className: 'border p-2' }, 'Продукция'),
                React.createElement('th', { className: 'border p-2' }, '№ Лота'),
                React.createElement('th', { className: 'border p-2' }, 'Количество'),
                React.createElement('th', { className: 'border p-2' }, 'Менеджер'),
                React.createElement('th', { className: 'border p-2' }, 'Действия')
              )
            ),
            React.createElement(
              'tbody',
              null,
              shipments
                .filter(item => item.company === company)
                .filter(item => filterProduct === 'Все продукты' || item.product === filterProduct)
                .filter(item => filterClient === 'Все клиенты' || item.client === filterClient)
                .filter(item => filterManager === 'Все менеджеры' || item.manager === filterManager)
                .filter(item => {
                  if (!startDate && !endDate) return true;
                  const itemDate = new Date(item.date);
                  const start = startDate ? new Date(startDate) : new Date(0);
                  const end = endDate ? new Date(endDate) : new Date();
                  end.setHours(23, 59, 59, 999);
                  return itemDate >= start && itemDate <= end;
                })
                .map((shipment, index) => React.createElement(
                  'tr',
                  { key: index },
                  React.createElement('td', { className: 'border p-2' }, shipment.date),
                  React.createElement('td', { className: 'border p-2' }, shipment.client),
                  React.createElement('td', { className: 'border p-2' }, shipment.product),
                  React.createElement('td', { className: 'border p-2' }, shipment.lot),
                  React.createElement('td', { className: 'border p-2' }, shipment.quantity),
                  React.createElement('td', { className: 'border p-2' }, shipment.manager),
                  React.createElement(
                    'td',
                    { className: 'border p-2' },
                    React.createElement(
                      'button',
                      { onClick: () => handleEdit(shipment), className: 'bg-yellow-500 text-white p-1 rounded mr-2' },
                      'Ред.'
                    ),
                    React.createElement(
                      'button',
                      { onClick: () => handleDelete(shipment, false), className: 'bg-red-500 text-white p-1 rounded' },
                      'Удал.'
                    )
                  )
                ))
            )
          )
        )
      );
    };

    try {
      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    } catch (e) {
      document.getElementById('error').innerText = 'Ошибка рендеринга: ' + e.message;
    }
  </script>
</body>
</html>